function isNumberKey(a){var b=a.which?a.which:a.keyCode;return!(46!=b&&b>31&&(b<48||b>57))}var app=angular.module("challengeApp",["ngRoute","ui.bootstrap","ngAnimate"]);app.config(["$routeProvider","$locationProvider",function(a,b){a.when("/",{templateUrl:"pages/home.html",controller:"mainController"}).when("/about-us",{templateUrl:"pages/about-us.html",controller:"aboutController"}).when("/contact-us",{templateUrl:"pages/contact-us.html",controller:"contactController"}).when("/gallery",{templateUrl:"pages/gallery.html",controller:"galleryController"}).when("/home",{templateUrl:"pages/home.html",controller:"mainController"}).when("/profile",{templateUrl:"pages/my-profile.html",controller:"profileController"}).when("/start-challenge",{templateUrl:"pages/start-challenge.html"}).when("/thank-you",{templateUrl:"pages/thank-you.html",controller:"thankyouController"}).when("/faq",{templateUrl:"pages/faq.html",controller:"faqController"})}]),app.factory("Session",function(a){var b={data:{},saveSession:function(){},updateSession:function(){a.get("/getSession").then(function(a){return b.data=a.data})}};return b}),app.directive("slideable",function(){return{restrict:"C",compile:function(a,b){var c=a.html();return a.html('<div class="slideable_content" style="margin:0 !important; padding:0 !important" >'+c+"</div>"),function(b,c,d){d.duration=d.duration?d.duration:"1s",d.easing=d.easing?d.easing:"ease-in-out",c.css({overflow:"hidden",height:"0px",transitionProperty:"height",transitionDuration:d.duration,transitionTimingFunction:d.easing})}}}}),app.directive("slideToggle",function(){return{restrict:"A",link:function(a,b,c){var d=document.querySelector(c.slideToggle);c.expanded=!1,b.bind("click",function(){var a=d.querySelector(".slideable_content");if(c.expanded)d.style.height="0px";else{a.style.border="1px solid rgba(0,0,0,0)";var b=a.clientHeight;a.style.border=0,d.style.height=b+"px"}c.expanded=!c.expanded})}}}),app.run(function(a,b,c,d){a.$on("$routeChangeStart",function(b,d,e){c.get("/getSession").success(function(b){b&&(a.user=b,void 0!=a.user&&("undefined"!=a.user.email&&void 0!=a.user.email||$("#email-pop").modal({backdrop:"static",keyboard:!1})))})})}),app.directive("numbersOnly",function(){return{require:"ngModel",link:function(a,b,c,d){function e(a){if(a){var b=a.replace(/[^0-9]/g,"");return b!==a&&(d.$setViewValue(b),d.$render()),b}}d.$parsers.push(e)}}}),app.directive("toggleClass",function(){return{restrict:"A",link:function(a,b,c){b.bind("click",function(){b.toggleClass(c.toggleClass)})}}}),app.controller("mainController",function(a,b,c,d){function e(a){var b=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return b.test(a)}a.data={},a.startChallenge=function(){void 0!=b.user&&""!=b.user?c.location.href="#/start-challenge":$("#login-popup").modal("show")},a.closeModal=function(){$("#login-popup").modal("hide")},a.login=function(a){"fb"==a&&$().facebookLogin(a),"google"==a&&$().googleLogin(a)},$.fn.facebookLogin=function(e){FB.login(function(f){console.log(f.authResponse),f.authResponse&&FB.api("/me",{fields:"id,first_name,last_name,picture, email, gender"},function(f){a.data.type=e,a.data.id=f.id,a.data.first_name=f.first_name,a.data.last_name=f.last_name,a.data.email=f.email,a.data.img=f.picture.data.url,console.log(a.data),FB.api("/"+f.id+"/picture?width=216",function(e){e&&!e.error&&(a.data.img=e.data.url,d.post("/saveUser",{data:a.data}).success(function(a){if("OK"==a.status){var d=a.result;b.user=d,c.location.href="#/profile"}}))})})},{scope:"email,public_profile",return_scopes:!0})},a.getEmail=function(f){e(f)?(a.data.email=f,d.post("/checkEmailDup",{data:a.data}).success(function(e){200==e.code?"fb"==a.data.type?FB.api("/"+a.data.id+"/picture?width=216",function(e){e&&!e.error&&(a.data.img=e.data.url,d.post("/saveUser",{data:a.data}).success(function(a){if(console.log(a),"OK"==a.status){var d=a.result;b.user=d,c.location.href="#/profile",$("#email-pop").modal("hide")}}))}):(a.data.type="twitter",d.post("/saveUser",{data:a.data}).success(function(a){if(console.log(a),"OK"==a.status){var d=a.result;b.user=d,c.location.href="#/profile",$("#email-pop").modal("hide")}})):a.message=e.message})):a.message="Enter Valid Email ID"},window.fbAsyncInit=function(){FB.init({appId:"1453646344961262",xfbml:!0,version:"v2.2"})},function(a,b,c){var d,e=a.getElementsByTagName(b)[0];a.getElementById(c)||(d=a.createElement(b),d.id=c,d.src="//connect.facebook.net/en_US/sdk.js",e.parentNode.insertBefore(d,e))}(document,"script","facebook-jssdk"),function(){var a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src="https://apis.google.com/js/client.js?onload=onLoadCallback";var b=document.getElementsByTagName("script")[0];b.parentNode.insertBefore(a,b)}(),$.fn.googleLogin=function(b){var c={clientid:"755750646212-hie3nejshns5gsd6gfqbnfvoihvr4tvt.apps.googleusercontent.com",cookiepolicy:"single_host_origin",callback:a.loginCallback,approvalprompt:"force",scope:"https://www.googleapis.com/auth/plus.login https://www.googleapis.com/auth/plus.profile.emails.read"};gapi.auth.signIn(c)},a.userInfoCallback=function(e){a.data.type="google",a.data.id=e.id,a.data.first_name=e.name.givenName,a.data.last_name=e.name.familyName,a.data.email=e.emails[0].value,a.data.img=e.image.url;var f=a.data.img,g=f.split("?");a.data.img=g[0]+"?sz=250",console.log(a.data.img),d.post("/saveUser",{data:a.data}).success(function(a){if("OK"==a.status){var d=a.result;b.user=d,c.location.href="#/profile"}})},a.loginCallback=function(b){b.access_token?gapi.client.request({path:"/plus/v1/people/me",method:"GET",callback:a.userInfoCallback}):b.error&&(a.signedIn=!1)},$.fn.onLoadCallback=function(){gapi.client.setApiKey("AIzaSyDor89kMIaagUpVhKc5ifpkvS_jk53lO_Y"),gapi.client.load("plus","v1",function(){})}}),app.controller("aboutController",function(a,b,c){function d(a){var b=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return b.test(a)}a.session=b,a.endorse={},a.showPopup=function(b){a.imgSrc=b,$("#img-pop").modal("show")},a.submit=function(){void 0!=a.endorse.first_name&&void 0!=a.endorse.last_name&&void 0!=a.endorse.phone&&void 0!=a.endorse.emailid&&void 0!=a.endorse.books?d(a.endorse.emailid)?a.endorse.phone.length<10?a.message="Enter valid Phone Number":c.post("/mailEndorse",{data:a.endorse}).success(function(b){"200"==b.code&&(a.endorse={},a.message="",a.SuccessMessage="Thank you! We'l get in touch with you for endorsement shortly!")}):a.message="Enter valid Email ID":a.message="Fill All the Fields!"}}),app.controller("contactController",function(a,b,c){function d(a){var b=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return b.test(a)}a.session=b,a.query={},a.submit=function(){void 0!=a.query.first_name&&void 0!=a.query.last_name&&void 0!=a.query.phone&&void 0!=a.query.emailid&&void 0!=a.query.subject&&void 0!=a.query.querymessage?d(a.query.emailid)?a.query.phone.length<10?a.message="Enter valid Phone Number":c.post("/mailEnquiry",{data:a.query}).success(function(b){"200"==b.code&&(a.query={},a.message="",a.SuccessMessage="Thank you! We'l get in touch right away!")}):a.message="Enter valid Email ID":a.message="Fill All the Fields!"}}),app.controller("galleryController",function(a,b){a.session=b,MAgallery("myGallery")}),app.controller("faqController",function(a,b){a.session=b}),app.controller("thankyouController",function(a,b){a.session=b,""==a.session.data?a.hasuser="false":(a.hasuser="true",a.username=a.session.data.first_name)}),app.controller("headerController",function(a,b,c,d,e){function g(a){var b=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return b.test(a)}a.data={},$("#navbar ul li a").on("click",function(){$(".navbar-toggle").click()}),a.login=function(a){"fb"==a&&$().facebookLogin(a),"google"==a&&$().googleLogin(a)};var f=e.path();"/"==f?a.homePage=!0:"/about-us"==f?a.aboutPage=!0:"/gallery"==f?a.galleryPage=!0:"/contact-us"==f?a.contactPage=!0:"/faq"==f&&(a.faqPage=!0),a.activeClass=function(b){MAgallery("myGallery"),"homePage"==b?(a.homePage=!0,a.aboutPage=!1,a.galleryPage=!1,a.contactPage=!1,a.faqPage=!1):"aboutPage"==b?(a.homePage=!1,a.aboutPage=!0,a.galleryPage=!1,a.contactPage=!1,a.faqPage=!1):"galleryPage"==b?(a.homePage=!1,a.aboutPage=!1,a.galleryPage=!0,a.contactPage=!1,a.faqPage=!1):"contactPage"==b?(a.homePage=!1,a.aboutPage=!1,a.galleryPage=!1,a.contactPage=!0,a.faqPage=!1):"faq"==b&&(a.homePage=!1,a.aboutPage=!1,a.galleryPage=!1,a.contactPage=!1,a.faqPage=!0)},a.logout=function(){b.get("/logout").success(function(){d.user="",c.location.href="#/"})},$.fn.facebookLogin=function(e){FB.login(function(f){f.authResponse&&FB.api("/me",{fields:"id,first_name,last_name,picture, email, gender"},function(f){a.data.type=e,a.data.id=f.id,a.data.first_name=f.first_name,a.data.last_name=f.last_name,a.data.email=f.email,a.data.img=f.picture.data.url,console.log(a.data),FB.api("/"+f.id+"/picture?width=216",function(e){e&&!e.error&&(a.data.img=e.data.url,b.post("/saveUser",{data:a.data}).success(function(a){if("OK"==a.status){var b=a.result;d.user=b,c.location.href="#/profile",location.reload()}}))})})},{scope:"email,public_profile",return_scopes:!0})},a.getEmail=function(e){g(e)?(a.data.email=e,b.post("/checkEmailDup",{data:a.data}).success(function(e){200==e.code?"fb"==a.data.type?FB.api("/"+a.data.id+"/picture?width=216",function(e){e&&!e.error&&(a.data.img=e.data.url,b.post("/saveUser",{data:a.data}).success(function(a){if(console.log(a),"OK"==a.status){var b=a.result;d.user=b,c.location.href="#/profile",$("#email-pop").modal("hide"),location.reload()}}))}):(a.data.type="twitter",b.post("/saveUser",{data:a.data}).success(function(a){if(console.log(a),"OK"==a.status){var b=a.result;d.user=b,c.location.href="#/profile",$("#email-pop").modal("hide")}})):a.message=e.message})):a.message="Enter Valid Email ID"},window.fbAsyncInit=function(){FB.init({appId:"1453646344961262",xfbml:!0,version:"v2.2"})},function(a,b,c){var d,e=a.getElementsByTagName(b)[0];a.getElementById(c)||(d=a.createElement(b),d.id=c,d.src="//connect.facebook.net/en_US/sdk.js",e.parentNode.insertBefore(d,e))}(document,"script","facebook-jssdk"),function(){var a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src="https://apis.google.com/js/client.js?onload=onLoadCallback";var b=document.getElementsByTagName("script")[0];b.parentNode.insertBefore(a,b)}(),$.fn.googleLogin=function(b){var c={clientid:"755750646212-hie3nejshns5gsd6gfqbnfvoihvr4tvt.apps.googleusercontent.com",cookiepolicy:"single_host_origin",callback:a.loginCallback,approvalprompt:"force",scope:"https://www.googleapis.com/auth/plus.login https://www.googleapis.com/auth/plus.profile.emails.read"};gapi.auth.signIn(c)},a.userInfoCallback=function(e){a.data.type="google",a.data.id=e.id,a.data.first_name=e.name.givenName,a.data.last_name=e.name.familyName,a.data.email=e.emails[0].value,a.data.img=e.image.url;var f=a.data.img,g=f.split("?");a.data.img=g[0]+"?sz=250",console.log(a.data.img),b.post("/saveUser",{data:a.data}).success(function(a){if("OK"==a.status){var b=a.result;d.user=b,c.location.href="#/profile"}})},a.loginCallback=function(b){b.access_token?gapi.client.request({path:"/plus/v1/people/me",method:"GET",callback:a.userInfoCallback}):b.error&&(a.signedIn=!1)},$.fn.onLoadCallback=function(){gapi.client.setApiKey("AIzaSyDor89kMIaagUpVhKc5ifpkvS_jk53lO_Y"),gapi.client.load("plus","v1",function(){})}}),app.controller("profileController",function(a,b,c,d){function e(a){$().select2fn(),$().countDown(a)}a.data={},a.content="reading",a.paytm={},a.regex="/^[0-9]{10}$/",void 0!=d.user&&""!=d.user||(window.location.href="#/"),$('[data-toggle="tooltip"]').tooltip(),$(".in").removeClass("modal-backdrop"),setTimeout(function(){$("#startChallenges").effect("shake",{direction:"up",times:2})},500),a.return=function(){b.get("/books").success(function(b){a.books=b.reading,a.timer=b.timer,a.orderStatus=b.status,null==a.timer||""==a.timer?0==a.books.length||void 0==a.books.length?(a.startChallenge=!0,$().select2fn()):(a.notConfirmChallenge=!0,$().select2fn()):"pickup"==a.orderStatus?(e(a.timer),a.startChallenge=!1,a.notConfirmChallenge=!1,a.existChallenge=!1,a.timerChallenge=!0,a.pickupRequest=!0):(e(a.timer),a.existChallenge=!0,a.timerChallenge=!0,$().select2fn())})},a.payDeposits=function(){var b=new Date,c=b.getTime();a.WalletOrderNumber="RABC"+a.profileData.user_id+c,a.depositeAmountWallet=a.depositeAmount,$("#deposite").modal()},a.withdraw=function(){$("#paytm-pop").modal(),a.message=""},a.sendRequest=function(){var c=a.paytm.mobile;void 0!=c&&10==c.toString().length?(b.post("/walletRequest",{number:c,id:a.profileData.user_id}).success(function(b){200==b.code&&(a.loadData(),$("#paytm-pop").modal("hide"),$("#thankyou-pop").modal())}),a.message=""):a.message="Please Enter Valid Mobile Number"},a.loadData=function(){a.depositBtnShow=!0,b.get("/my-profile").success(function(b){a.profileData=b,a.depositeAmount=500-a.profileData.wallet,0==a.depositeAmount&&(a.depositBtnShow=!1)}),b.get("/city").success(function(b){a.city=b}),b.get("/pincode").success(function(b){a.pincode=b}),b.get("/walletRequestStatus").success(function(b){a.wallet_status=b.status}),b.get("/genre").success(function(b){var c=[];a.gnere=b.genres;var d=b.interested;for(i=0;i<d.length;i++)c.push(d[i].category_id);setTimeout(function(){$("#interestCategory").val(c).trigger("change")},500)}),b.get("/books").success(function(b){a.books=b.reading,a.timer=b.timer,a.orderStatus=b.status,null==a.timer||""==a.timer?0==a.books.length||void 0==a.books.length?(a.startChallenge=!0,$().select2fn()):(a.notConfirmChallenge=!0,$().select2fn()):"pickup"==a.orderStatus?(e(a.timer),a.startChallenge=!1,a.notConfirmChallenge=!1,a.existChallenge=!1,a.timerChallenge=!0,a.pickupRequest=!0):(e(a.timer),a.existChallenge=!0,a.timerChallenge=!0,$().select2fn())}),a.loadWishlist(),a.loadLibrary()},a.editProfile=function(){$().removeDisabled()},a.updateProfile=function(){""!=a.profileData.first_name&&""!=a.profileData.last_name&&""!=a.profileData.phone_number&&""!=a.profileData.email_id&&""!=a.profileData.age&&""!=a.profileData.address&&""!=a.profileData.city&&""!=a.profileData.area&&""!=a.profileData.landmark&&""!=a.profileData.pincode&&void 0!=a.profileData.first_name&&void 0!=a.profileData.last_name&&void 0!=a.profileData.phone_number&&void 0!=a.profileData.email_id&&void 0!=a.profileData.age&&void 0!=a.profileData.address&&void 0!=a.profileData.city&&void 0!=a.profileData.area&&void 0!=a.profileData.landmark&&void 0!=a.profileData.pincode?b.put("/updateProfile",{data:a.profileData}).success(function(c){console.log(c),"failed"==c.status?(a.updateErrorMessage="",a.updateErrorMessage=c.message):(a.updateSuccessMessage="Updated Successfully!",b.get("/my-profile").success(function(b){a.profileData=b}))}):a.updateErrorMessage="Please Fill all the Mandatory Fields!"},a.returnPopup=function(){a.reason=!0,a.newBook=!1,a.returnBook=!1,$("#return-books").modal()},a.extendPopup=function(){$("#time-ext").modal()};var f="readabookchallenge@gmail.com",g="3a3bdd183ec7601ae380c99c4ad01445ebb1c3ea",h="0",j="RDBOOK";a.extendTime=function(){b.post("/extendTime",{time:a.extendTimeVal,books:a.books.length}).success(function(c){if(200==c.code){$("#time-ext").modal("hide"),$("#time-thankyou-pop").modal("show"),a.loadData();var d="Hi "+a.profileData.first_name+", Your extension request for "+a.extendTimeVal+" weeks for the Read a Book Challenge has been processed. Happy Reading !",e=a.profileData.phone_number,i="username="+f+"&hash="+g+"&message="+d+"&sender="+j+"&numbers="+e+"&test="+h;b.post("http://api.textlocal.in/send/?"+i).success(function(a,b){console.log(a),console.log(b)})}else 400==c.code&&(a.extError=c.message)})},a.getAmount=function(c){c>0&&c<5&&b.post("/getExtendAmount",{week:c,books:a.books.length}).success(function(b){a.extendAmntHolder=!0,a.extendAmountWeeks=b.amount})},a.payDeposit=function(){},a.selectOption=function(b){a.reason=!0,a.newBook=!1,a.returnBook=!1,"returnBook"==b?(a.reason=!1,a.returnBook=!0):"newBook"==b&&(a.newBook=!0)},a.returnContinue=function(){a.reason?b.post("/setDeliveryType",{val:"pickup & delivery"}).success(function(a){200==a.code&&(c.location.href="#/start-challenge",location.reload())}):""!=a.returnReason&&void 0!=a.returnReason?(a.reasonEmpty=!1,b.post("/onlyPickup",{reason:a.returnReason}).success(function(c){if(1==c.affectedRows){a.loadData(),$("#return-books").modal("hide");var d="Hi "+a.profileData.first_name+", Your pick up request has been placed and will take place in the next two days, do make sure someone is available at the address with the books.",e=a.profileData.phone_number,i="username="+f+"&hash="+g+"&message="+d+"&sender="+j+"&numbers="+e+"&test="+h;b.post("http://api.textlocal.in/send/?"+i).success(function(a,b){console.log(a),console.log(b)})}})):a.reasonEmpty=!0},a.start_challenge=function(){b.post("/setDeliveryType",{val:"delivery"}).success(function(a){200==a.code?c.location.href="#/start-challenge":$("#taken_challenge_pop").modal("show")})},a.wishsearchResults={};var k=0;a.wishlistSearch=function(b){""!=b&&void 0!=b&&b.length>3&&$.get("https://www.googleapis.com/books/v1/volumes?q="+b+"&maxResults=10",function(b,c){"success"==c&&(k++,console.log(b),a.searchResults=b.items,a.wishsearchResults=a.searchResults,a.wishlistContent=!0,1==k&&$("#searchwishlist").click())})},a.addWishlist=function(c,d){var e=c.volumeInfo.title;c.volumeInfo.title=e.replace(/'/g,"\\'"),b.post("/wishlistAdd",{data:c}).success(function(b){if(a.loadWishlist(),1==b.affectedRows){var c=a.wishsearchResults[d];c.status="DONE",a.loadWishlist(),a.wishlistContent=!1,a.libContent=!1}else c.status="DONE"})},a.loadWishlist=function(){b.get("/loadWishlist").success(function(b){console.log(b),200==b.code?(a.emptyWishlist="",a.listWishlist=b.data):(a.emptyWishlist=b.message,a.listWishlist={})})},a.removeWishlist=function(c){b.post("/wishlistDelete",{id:c}).success(function(b){a.loadWishlist()})},a.listsearchResults={};var k=0;a.librarySearch=function(b){""!=b&&void 0!=b&&b.length>3&&$.get("https://www.googleapis.com/books/v1/volumes?q="+b+"&maxResults=10",function(b,c){"success"==c&&(k++,console.log(b),a.searchResults=b.items,a.listsearchResults=a.searchResults,a.libContent=!0,1==k&&$("#searchlibrary").click())})},a.addLibrary=function(c,d){var e=c.volumeInfo.title;c.volumeInfo.title=e.replace(/'/g,"\\'"),b.post("/libraryAdd",{data:c}).success(function(b){if(1==b.affectedRows){var c=a.listsearchResults[d];c.status="DONE",a.loadLibrary(),a.wishlistContent=!1,a.libContent=!1}else c.status="DONE"})},a.loadLibrary=function(){b.get("/loadLibrary").success(function(b){200==b.code?(a.listLibrary=b.data,a.emptyLibrary=""):(a.emptyLibrary=b.message,a.listLibrary={})})},a.removeLibrary=function(c){b.post("/libraryDelete",{id:c}).success(function(b){a.loadLibrary()})},a.closeWishlist=function(){a.wishlistContent=!1,a.libContent=!1},a.closeModal=function(){$("#deposite").modal("hide"),$("#paytm-pop").modal("hide"),$("#thankyou-pop").modal("hide"),$("#return-books").modal("hide"),$("#time-ext").modal("hide"),$("#taken_challenge_pop").modal("hide")},setTimeout(function(){a.return()},500);var l=0,m=0;$.fn.select2fn=function(){$("#interestCategory").select2().on("select2:selecting",function(a){l++,4==l&&b.post("/updateGenere",{id:a.params.args.data.id}).success(function(a){l=0})}).on("select2:unselecting",function(a){m++,4==m&&b.post("/updateGenere",{id:a.params.args.data.id}).success(function(a){m=0})}),$("#profile").find("input").attr("disabled","true"),$("#profile").find("select").attr("disabled","true")},$.fn.removeDisabled=function(){$("#profile").find("input").removeAttr("disabled"),$("#profile").find("select").removeAttr("disabled")},$.fn.countDown=function(a){$("#future_date").countdowntimer({dateAndTime:a,size:"lg",regexpMatchFormat:"([0-9]{1,2}):([0-9]{1,2}):([0-9]{1,2}):([0-9]{1,2})",regexpReplaceWith:"<span class='timer-profile'>$1</span>:<span class='timer-profile'>$2</span>:<span class='timer-profile'>$3</span>:<span class='timer-profile'>$4</span>"})},a.loadData()}),app.controller("startChallengeController",function(a,b,c,d){function j(a){setTimeout(function(){for(i=0;i<a.length;i++)$(".active_"+a[i].category_id).addClass("active")},500)}a.data={},a.step="step1",a.payment="credit card",a.orders={},void 0!=b.user&&""!=b.user||(window.location.href="#/"),a.return=function(){c.get("/books").success(function(b){a.books=b.reading,a.timer=b.timer,0==b.length||void 0==b.length?a.checkChallenge=!1:(d.location.href="#/profile",a.checkChallenge=!1)}),c.get("/genre").success(function(b){a.gnere=b.genres,a.interested=b.interested,j(a.interested)}),c.get("/checkChallenge").success(function(a){400==a.code&&(d.location.href="#/profile")})},a.updateCategory=function(a){c.post("/updateGenere",{id:a}).success(function(a){})},a.changeStep2=function(){a.orders.noOfBooks>0?c.get("/genre").success(function(b){a.interested=b.interested,a.interested.length>0?c.post("/price",{count:a.orders.noOfBooks,interested:a.interested}).success(function(b){for(a.message="",a.orders.delivery_charge=b.plan.delivery_charge,a.orders.no_of_book=b.plan.no_of_book,a.orders.pickup_charge=b.plan.pickup_charge,a.orders.price_per_month=b.plan.price_per_month,a.orders.cat_name="",a.orders.cat_ids="",i=0;i<b.cat_name.length;i++)a.orders.cat_name+=b.cat_name[i].category_name+",",a.orders.cat_ids+=b.cat_name[i].id+",";a.orders.cat_name=a.orders.cat_name.replace(/(^,)|(,$)/g,""),a.orders.cat_ids=a.orders.cat_ids.replace(/(^,)|(,$)/g,"");var c=new Date,d=new Date(c);d.setDate(d.getDate()+6);var k,e=new Date(d),f=["January","February","March","April","May","June","July","August","September","October","November","December"],c=new Date(e),g=c.getDate(),h=c.getMonth(),j=c.getFullYear();k=1==g?"st":2==g?"nd":3==g?"rd":"th",a.orders.expectedDate=g+k+" "+f[h]+" "+j,a.orders.deposit=500-a.profileData.wallet,a.orders.total=parseInt(a.orders.price_per_month)+parseInt(a.orders.pickup_charge)+parseInt(a.orders.delivery_charge)+parseInt(a.orders.deposit),a.step="step2"}):a.message="Please Choose one of the Genres!"}):a.message="Please Choose Number of Books"},a.changeStep3=function(){""!=a.profileData.address&&""!=a.profileData.city&&""!=a.profileData.area&&""!=a.profileData.pincode&&""!=a.profileData.phone_number&&""!=a.profileData.alt_phone_number?c.put("/updateProfile",{data:a.profileData,orderData:a.orders}).success(function(b){a.message="",a.step="step3",a.FinalOrderNumber=b.someText}):a.message="Please Fill all the Fields!"},a.changeStep1=function(){c.get("/genre").success(function(b){a.gnere=b.genres,a.interested=b.interested,j(a.interested)}),a.step="step1"},a.loadData=function(){c.get("/my-profile").success(function(b){a.profileData=b}),c.get("/city").success(function(b){a.city=b}),c.get("/pincode").success(function(b){a.pincode=b})};var e="readabookchallenge@gmail.com",f="3a3bdd183ec7601ae380c99c4ad01445ebb1c3ea",g="0",h="RDBOOK";a.finalCheckout=function(b){var i;$.getJSON("http://jsonip.com/?callback=?",function(j){i=j.ip,c.post("/checkOut",{order:a.orders,profile:a.profileData,type:b,ip:i}).success(function(b){if(200==b.code){d.location.href="#/thank-you";var i="Hi "+a.profileData.first_name+", Your order has been successfully placed. Expected date of delivery on or before "+a.orders.expectedDate+". Please make sure someone is available at the address.",j=a.profileData.phone_number,k="username="+e+"&hash="+f+"&message="+i+"&sender="+h+"&numbers="+j+"&test="+g;c.post("http://api.textlocal.in/send/?"+k).success(function(a,b){console.log(a),console.log(b)})}})})}});